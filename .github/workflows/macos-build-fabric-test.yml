name: Test new architecture macOS build

on:
  pull_request:
    paths:
      - '.github/workflows/macos-fabric-test.yml'
      - 'RNSVG.podspec'
      - 'apple/**'
      - 'macos-example/package.json'
      - 'macos-example/macos/**'
      - 'src/fabric/**'
      - 'package.json'
  push:
    branches:
      - main

jobs:
  test-build:
    runs-on: ubuntu-latest
    if: github.repository == 'software-mansion/react-native-svg'
    steps:
    - name: Extract branch name
      id: extract_branch
      uses: keptn/gh-action-extract-branch-name@main
      with:
        GITHUB_REF: ${{ github.ref }}

      - name: Call reusable workflow
      uses: 'software-mansion/react-native-svg/.github/workflows/reusable-macos-build.yml@${{ steps.extract_branch.outputs.BRANCH }}'
      with:
        new_arch_enabled: '1'
