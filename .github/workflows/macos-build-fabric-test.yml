name: Test new architecture macOS build
on:
  pull_request:
    paths:
      - '.github/workflows/macos-build-fabric-test.yml'
      - 'RNSVG.podspec'
      - 'apple/**'
      - 'macos-example/package.json'
      - 'macos-example/macos/**'
      - 'src/fabric/**'
      - 'package.json'
  push:
    branches:
      - main

jobs:
  set-ref:
    runs-on: ubuntu-latest
    outputs:
      ref: ${{ steps.set-ref.outputs.ref }}
    steps:
      - name: Set reference
        id: set-ref
        run: echo "ref=${GITHUB_HEAD_REF:-$GITHUB_REF_NAME}" >> $GITHUB_ENV

  test-build:
    needs: set-ref
    if: github.repository == 'software-mansion/react-native-svg'
    uses: 'software-mansion/react-native-svg/.github/workflows/reusable-macos-build.yml@${{ needs.set-ref.outputs.ref }}'
    with:
      new_arch_enabled: 1
